<!DOCTYPE html>
<html lang="en" data-theme="cupcake">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Folder to PDF Converter</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" crossorigin="anonymous"></script>
</head>
<body class="bg-base-200 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="card w-full max-w-lg bg-base-100 shadow-xl">
        <div class="card-body">
            <h1 class="card-title text-3xl mb-6 text-center">Upload Folder to Create PDF</h1>

            <form id="upload-form"
                  hx-post="/upload"
                  hx-encoding="multipart/form-data"
                  hx-target="#response-area"
                  hx-swap="innerHTML"
                  hx-indicator="#spinner"
                  class="space-y-4">

                <div>
                    <label class="label" for="folder-upload">
                        <span class="label-text">Select Folder</span>
                        <span class="label-text-alt">Contains .webp, .jpg, .png</span>
                    </label>
                    <input type="file"
                           name="files"
                           id="folder-upload"
                           class="file-input file-input-bordered file-input-primary w-full"
                           webkitdirectory directory multiple required />
                    <p class="text-xs text-base-content/70 mt-1">
                        Your browser will ask for permission to access the folder contents.
                        All supported image files within the selected folder (and its subfolders) will be processed.
                    </p>
                </div>

                <div class="card-actions justify-center mt-6">
                    <button type="submit" class="btn btn-primary btn-wide">
                        <span id="spinner" class="htmx-indicator loading loading-spinner loading-sm"></span>
                        Create PDF
                    </button>
                </div>
            </form>

            <div id="response-area" class="mt-6 text-center">
                <!-- Server messages or errors will appear here -->
                <!--
                    Note: For direct file downloads, HTMX might not update this area if the server
                    responds with Content-Disposition. The browser handles the download directly.
                    This area is more for status messages or if the server returns HTML (e.g., an error message).
                -->
            </div>
             <div id="htmx-error-response" class="mt-4 text-red-500 text-center">
                <!-- HTMX error responses can be directed here -->
            </div>
        </div>
    </div>

    <footer class="footer footer-center p-4 mt-8 text-base-content/50">
        <div>
            <p>Powered by Go, HTMX, Tailwind CSS & DaisyUI</p>
        </div>
    </footer>

    <script>
        // Optional: Show a more user-friendly message during HTMX request
        document.body.addEventListener('htmx:beforeRequest', function(evt) {
            const responseArea = document.getElementById('response-area');
            if (evt.detail.elt.id === 'upload-form' && responseArea) {
                responseArea.innerHTML = '<p class="text-info">Processing your files... please wait.</p>';
            }
        });

        // Optional: Handle cases where the server sends an error that HTMX might not directly place,
        // or if the response is not what's expected for a swap.
        // This listens for HTMX specific error events.
        document.body.addEventListener('htmx:responseError', function(evt) {
            const errorDiv = document.getElementById('htmx-error-response');
            if (errorDiv) {
                let errorMsg = 'An error occurred while processing your request.';
                if (evt.detail.xhr) {
                    // Try to get a more specific error from the XHR responseText if it's not a PDF
                    if (evt.detail.xhr.getResponseHeader('Content-Type') !== 'application/pdf') {
                         errorMsg = evt.detail.xhr.responseText || errorMsg;
                    } else if (evt.detail.xhr.status >= 400) {
                        // If it was supposed to be a PDF but we got an error status
                        errorMsg = `Error ${evt.detail.xhr.status}: Could not generate or retrieve PDF. Server said: ${evt.detail.xhr.statusText}`;
                    }
                }
                // Sanitize errorMsg before inserting into HTML if it can contain user-generated content from server
                // For now, assuming server error messages are safe or plain text.
                errorDiv.innerHTML = `<div class="alert alert-error"><div><span>${errorMsg}</span></div></div>`;
            }
            // Clear the "processing" message from the main response area
            const responseArea = document.getElementById('response-area');
            if (responseArea) {
                responseArea.innerHTML = '';
            }
        });

        // Clear errors on new request
        document.body.addEventListener('htmx:configRequest', function(evt) {
            const errorDiv = document.getElementById('htmx-error-response');
            if (errorDiv) {
                errorDiv.innerHTML = '';
            }
        });

    </script>

</body>
</html>
